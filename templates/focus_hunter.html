{% extends 'base.html' %} {% block title %}Focus Hunter | EEG-ADHD{% endblock %}
{% block content %}

<style>
  .focus-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 20px;
    text-align: center;
  }

  .game-header {
    margin-bottom: 30px;
  }

  .game-header h1 {
    font-size: 2.5rem;
    margin-bottom: 15px;
    background: linear-gradient(135deg, #00c9a7, #c471ed);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .game-header p {
    font-size: 1.1rem;
    color: #e0e0e0;
    margin-bottom: 20px;
  }

  /* Indicador TBR */
  .tbr-indicator {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 30px;
    border: 2px solid rgba(0, 201, 167, 0.3);
  }

  .tbr-indicator h3 {
    margin: 0;
    color: #e0e0e0;
    font-size: 1.2rem;
  }

  .tbr-value {
    color: #00c9a7;
    font-weight: bold;
    font-size: 1.4rem;
  }

  .status-indicator {
    display: inline-block;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: bold;
    margin-left: 10px;
  }

  .status-normal {
    background-color: #28a745;
    color: white;
  }
  .status-elevated {
    background-color: #ffc107;
    color: #212529;
  }
  .status-high {
    background-color: #dc3545;
    color: white;
  }

  /* √Årea de juego */
  .game-area {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 20px;
    padding: 40px;
    margin: 30px 0;
    min-height: 400px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    border: 3px solid rgba(0, 201, 167, 0.2);
  }

  .stimulus {
    font-size: 8rem;
    font-weight: bold;
    color: #00c9a7;
    margin: 50px 0;
    transition: all 0.2s ease;
    text-shadow: 0 0 20px rgba(0, 201, 167, 0.5);
  }

  .stimulus.target {
    color: #c471ed;
    text-shadow: 0 0 20px rgba(196, 113, 237, 0.5);
  }

  .stimulus.correct {
    color: #28a745;
    transform: scale(1.2);
  }

  .stimulus.incorrect {
    color: #dc3545;
    transform: scale(0.8);
  }

  /* Informaci√≥n del juego */
  .game-info {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .info-card {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    padding: 20px;
    border: 2px solid rgba(0, 201, 167, 0.2);
  }

  .info-card h4 {
    color: #00c9a7;
    margin-bottom: 10px;
    font-size: 1.1rem;
  }

  .info-value {
    font-size: 1.8rem;
    font-weight: bold;
    color: #e0e0e0;
  }

  /* Controles */
  .game-controls {
    margin: 30px 0;
  }

  .btn-game {
    background: linear-gradient(135deg, #00c9a7, #c471ed);
    color: white;
    border: none;
    padding: 15px 30px;
    border-radius: 25px;
    font-size: 1.1rem;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    margin: 0 10px;
  }

  .btn-game:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 201, 167, 0.4);
  }

  .btn-game:disabled {
    background: #666;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  /* Instrucciones */
  .instructions {
    background: rgba(0, 201, 167, 0.1);
    border: 2px solid rgba(0, 201, 167, 0.3);
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 30px;
    text-align: left;
  }

  .instructions h3 {
    color: #00c9a7;
    margin-bottom: 15px;
  }

  .instructions ul {
    color: #e0e0e0;
    line-height: 1.6;
  }

  .instructions li {
    margin-bottom: 8px;
  }

  /* Progreso */
  .progress-container {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    height: 20px;
    margin: 20px 0;
    overflow: hidden;
  }

  .progress-bar {
    background: linear-gradient(90deg, #00c9a7, #c471ed);
    height: 100%;
    width: 0%;
    transition: width 0.3s ease;
  }

  /* Resultados */
  .results-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 1000;
  }

  .results-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(135deg, #1a1a2e, #16213e);
    border-radius: 20px;
    padding: 40px;
    max-width: 600px;
    width: 90%;
    border: 3px solid #00c9a7;
  }

  .results-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    margin: 20px 0;
  }

  .result-item {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    padding: 15px;
    text-align: center;
  }

  .result-item h4 {
    color: #00c9a7;
    margin-bottom: 10px;
    font-size: 1rem;
  }

  .result-value {
    font-size: 1.5rem;
    font-weight: bold;
    color: #e0e0e0;
  }

  /* Alertas */
  .instructions-alert {
    background: rgba(0, 201, 167, 0.2);
    border: 2px solid #00c9a7;
    border-radius: 10px;
    padding: 15px;
    margin: 15px 0;
    color: #e0e0e0;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .focus-container {
      padding: 10px;
    }

    .stimulus {
      font-size: 6rem;
    }

    .game-info {
      grid-template-columns: repeat(2, 1fr);
    }

    .results-grid {
      grid-template-columns: 1fr;
    }
  }
</style>

<div class="focus-container">
  <div class="game-header">
    <h1>üéØ Focus Hunter EEG</h1>
    <p>
      Evaluate your sustained attention through a continuous vigilance task
      while we monitor your brain activity
    </p>
  </div>

  <!-- Indicador TBR en tiempo real -->
  <div class="tbr-indicator">
    <h3>
      Current TBR: <span class="tbr-value" id="currentTBR">--</span>
      <span class="status-indicator" id="tbrStatus">Connecting...</span>
    </h3>
  </div>

  <!-- Instrucciones -->
  <div class="instructions">
    <h3>üìã Focus Hunter Instructions</h3>
    <ul>
      <li>
        <strong>Objective:</strong> Press SPACE only when you see the letter
        <strong style="color: #c471ed">"X"</strong>
      </li>
      <li>
        <strong>DO NOT press</strong> SPACE for other letters (O, T, L, etc.)
      </li>
      <li><strong>Duration:</strong> 6 minutes of continuous vigilance</li>
      <li>
        <strong>Concentration:</strong> Maintain attention throughout the
        test
      </li>
      <li>
        <strong>Posture:</strong> Sit comfortably and avoid sudden movements
      </li>
    </ul>
  </div>

  <!-- Informaci√≥n del juego -->
  <div class="game-info">
    <div class="info-card">
      <h4>‚è±Ô∏è Time</h4>
      <div class="info-value" id="timeDisplay">6:00</div>
    </div>
    <div class="info-card">
      <h4>üéØ Hits</h4>
      <div class="info-value" id="hitsDisplay">0</div>
    </div>
    <div class="info-card">
      <h4>‚ùå Errors</h4>
      <div class="info-value" id="errorsDisplay">0</div>
    </div>
    <div class="info-card">
      <h4>üìä Accuracy</h4>
      <div class="info-value" id="accuracyDisplay">100%</div>
    </div>
  </div>

  <!-- Barra de progreso -->
  <div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <!-- √Årea de juego -->
  <div class="game-area" id="gameArea">
    <div class="stimulus" id="stimulus">?</div>
  </div>

  <!-- Controles -->
  <div class="game-controls">
    <button class="btn-game" id="startBtn" onclick="startGame()">
      Start Focus Hunter
    </button>
    <button class="btn-game" id="pauseBtn" onclick="pauseGame()" disabled>
      Pause
    </button>
    <button class="btn-game" onclick="window.location.href='/pruebas'">
      Back to Tests
    </button>
  </div>
</div>

<!-- Modal de Resultados -->
<div class="results-modal" id="resultsModal">
  <div class="results-content">
    <h2 style="color: #00c9a7; text-align: center; margin-bottom: 20px">
      üéØ Focus Hunter Results
    </h2>

    <div class="results-grid">
      <div class="result-item">
        <h4>‚è±Ô∏è Tiempo Total</h4>
        <div class="result-value" id="finalTime">6:00</div>
      </div>
      <div class="result-item">
        <h4>üéØ Aciertos</h4>
        <div class="result-value" id="finalHits">0</div>
      </div>
      <div class="result-item">
        <h4>‚ùå Omissions</h4>
        <div class="result-value" id="finalOmissions">0</div>
      </div>
      <div class="result-item">
        <h4>‚ö° Commissions</h4>
        <div class="result-value" id="finalCommissions">0</div>
      </div>
      <div class="result-item">
        <h4>üìä Accuracy</h4>
        <div class="result-value" id="finalAccuracy">100%</div>
      </div>
      <div class="result-item">
        <h4>‚ö° Reaction Time</h4>
        <div class="result-value" id="finalReactionTime">0ms</div>
      </div>
      <div class="result-item">
        <h4>üìà Average TBR</h4>
        <div class="result-value" id="finalTBR">0.00</div>
      </div>
      <div class="result-item">
        <h4>üèÜ Score</h4>
        <div class="result-value" id="finalScore">0</div>
      </div>
    </div>

    <div style="text-align: center; margin-top: 30px">
      <button class="btn-game" onclick="closeResults()">Close</button>
      <button class="btn-game" onclick="restartGame()">Play Again</button>
    </div>
  </div>
</div>

<script>
  // Variables del juego
  let gameActive = false;
  let gamePaused = false;
  let gameTimer = null;
  let tbrTimer = null;
  let stimulusTimer = null;

  // Configuraci√≥n del juego
  const GAME_DURATION = 360; // 6 minutos en segundos
  const STIMULUS_INTERVAL = 1500; // 1.5 segundos entre est√≠mulos
  const STIMULUS_DURATION = 500; // Duraci√≥n del est√≠mulo en pantalla
  const TARGET_PROBABILITY = 0.3; // 30% de probabilidad de que aparezca X

  // Variables de estado
  let timeRemaining = GAME_DURATION;
  let currentStimulus = '';
  let isTargetStimulus = false;
  let stimulusStartTime = 0;
  let waitingForResponse = false;

  // M√©tricas del juego
  let hits = 0; // Respuestas correctas a X
  let omissions = 0; // No responder a X
  let commissions = 0; // Responder a no-X
  let reactionTimes = [];
  let tbrValues = [];
  let totalTargets = 0;
  let totalNonTargets = 0;

  // Est√≠mulos disponibles
  const STIMULI = ['X', 'O', 'T', 'L', 'H', 'P', 'F', 'N', 'M', 'R'];
  const TARGET_STIMULUS = 'X';

  // Inicializar juego
  function startGame() {
    if (gameActive) return;

    // Resetear variables
    gameActive = true;
    gamePaused = false;
    timeRemaining = GAME_DURATION;
    hits = 0;
    omissions = 0;
    commissions = 0;
    reactionTimes = [];
    tbrValues = [];
    totalTargets = 0;
    totalNonTargets = 0;

    // Actualizar UI
    document.getElementById('startBtn').disabled = true;
    document.getElementById('pauseBtn').disabled = false;
    document.getElementById('stimulus').textContent = '';

    // Iniciar timers
    startGameTimer();
    startTBRMonitoring();
    scheduleNextStimulus();

    console.log('Focus Hunter iniciado');
  }

  function pauseGame() {
    if (!gameActive) return;

    gamePaused = !gamePaused;

    if (gamePaused) {
      clearTimeout(stimulusTimer);
      document.getElementById('pauseBtn').textContent = 'Resume';
      document.getElementById('stimulus').textContent = '‚è∏Ô∏è';
    } else {
      scheduleNextStimulus();
      document.getElementById('pauseBtn').textContent = 'Pause';
    }
  }

  function endGame() {
    gameActive = false;
    gamePaused = false;

    // Limpiar timers
    clearInterval(gameTimer);
    clearInterval(tbrTimer);
    clearTimeout(stimulusTimer);

    // Actualizar UI
    document.getElementById('startBtn').disabled = false;
    document.getElementById('pauseBtn').disabled = true;
    document.getElementById('stimulus').textContent = 'üèÅ';

    // Mostrar resultados
    showResults();

    // Guardar resultados
    saveGameResults();

    console.log('Focus Hunter terminado');
  }

  function restartGame() {
    closeResults();
    endGame();
    setTimeout(() => startGame(), 500);
  }

  // Timer del juego
  function startGameTimer() {
    gameTimer = setInterval(() => {
      if (!gamePaused) {
        timeRemaining--;
        updateTimeDisplay();
        updateProgress();

        if (timeRemaining <= 0) {
          endGame();
        }
      }
    }, 1000);
  }

  function updateTimeDisplay() {
    const minutes = Math.floor(timeRemaining / 60);
    const seconds = timeRemaining % 60;
    document.getElementById('timeDisplay').textContent = `${minutes}:${seconds
      .toString()
      .padStart(2, '0')}`;
  }

  function updateProgress() {
    const progress = ((GAME_DURATION - timeRemaining) / GAME_DURATION) * 100;
    document.getElementById('progressBar').style.width = `${progress}%`;
  }

  // Manejo de est√≠mulos
  function scheduleNextStimulus() {
    if (!gameActive || gamePaused) return;

    stimulusTimer = setTimeout(() => {
      showStimulus();
    }, STIMULUS_INTERVAL + Math.random() * 500); // Variabilidad de ¬±250ms
  }

  function showStimulus() {
    if (!gameActive || gamePaused) return;

    // Determinar si es est√≠mulo objetivo
    isTargetStimulus = Math.random() < TARGET_PROBABILITY;

    if (isTargetStimulus) {
      currentStimulus = TARGET_STIMULUS;
      totalTargets++;
    } else {
      // Seleccionar est√≠mulo no objetivo
      const nonTargets = STIMULI.filter(s => s !== TARGET_STIMULUS);
      currentStimulus =
        nonTargets[Math.floor(Math.random() * nonTargets.length)];
      totalNonTargets++;
    }

    // Mostrar est√≠mulo
    const stimulusElement = document.getElementById('stimulus');
    stimulusElement.textContent = currentStimulus;
    stimulusElement.className = isTargetStimulus
      ? 'stimulus target'
      : 'stimulus';

    // Configurar respuesta
    stimulusStartTime = Date.now();
    waitingForResponse = true;

    // Ocultar est√≠mulo despu√©s de STIMULUS_DURATION
    setTimeout(() => {
      if (waitingForResponse && isTargetStimulus) {
        // Omisi√≥n: no respondi√≥ a X
        omissions++;
        waitingForResponse = false;
        updateGameStats();
      }

      stimulusElement.textContent = '';
      stimulusElement.className = 'stimulus';

      // Programar siguiente est√≠mulo
      scheduleNextStimulus();
    }, STIMULUS_DURATION);
  }

  // Manejo de respuestas del teclado
  document.addEventListener('keydown', function (event) {
    if (!gameActive || gamePaused || !waitingForResponse) return;

    if (event.code === 'Space') {
      event.preventDefault();
      handleResponse();
    }
  });

  function handleResponse() {
    if (!waitingForResponse) return;

    const reactionTime = Date.now() - stimulusStartTime;
    waitingForResponse = false;

    const stimulusElement = document.getElementById('stimulus');

    if (isTargetStimulus) {
      // Acierto: respondi√≥ correctamente a X
      hits++;
      reactionTimes.push(reactionTime);
      stimulusElement.classList.add('correct');
    } else {
      // Comisi√≥n: respondi√≥ incorrectamente a no-X
      commissions++;
      stimulusElement.classList.add('incorrect');
    }

    updateGameStats();

    // Remover clase visual despu√©s de un momento
    setTimeout(() => {
      stimulusElement.classList.remove('correct', 'incorrect');
    }, 200);
  }

  function updateGameStats() {
    document.getElementById('hitsDisplay').textContent = hits;
    document.getElementById('errorsDisplay').textContent =
      omissions + commissions;

    const totalResponses = hits + omissions + commissions;
    const accuracy =
      totalResponses > 0
        ? Math.round((hits / (hits + omissions + commissions)) * 100)
        : 100;
    document.getElementById('accuracyDisplay').textContent = `${accuracy}%`;
  }

  // Monitoreo TBR
  function startTBRMonitoring() {
    // Verificar conexi√≥n inicial
    updateTBRValue();

    // Monitoreo continuo cada 2 segundos
    tbrTimer = setInterval(updateTBRValue, 2000);
  }

  async function updateTBRValue() {
    if (!gameActive) return;

    try {
      const response = await fetch('/tbr_value');
      const data = await response.json();

      if (data.error) {
        handleTBRError(data);
      } else if (data.tbr_value) {
        const tbr = parseFloat(data.tbr_value);
        tbrValues.push(tbr);

        // Actualizar display
        document.getElementById('currentTBR').textContent = tbr.toFixed(2);

        // Actualizar estado
        updateTBRStatus(tbr, data);

        // Verificar si es modo simulaci√≥n
        if (data.simulated) {
          handleSimulatedMode(data);
        }
      }
    } catch (error) {
      console.error('Error obteniendo TBR:', error);
    }
  }

  // Manejar errores de TBR
  function handleTBRError(data) {
    const statusElement = document.getElementById('tbrStatus');
    const tbrElement = document.getElementById('currentTBR');

    switch (data.error) {
      case 'not_calibrated':
        statusElement.textContent = 'Not Calibrated';
        statusElement.className = 'status-indicator status-elevated';
        tbrElement.textContent = '--';
        break;
      case 'eeg_disconnected':
        statusElement.textContent = 'EEG Disconnected';
        statusElement.className = 'status-indicator status-high';
        tbrElement.textContent = '--';
        break;
      case 'no_data':
        statusElement.textContent = 'No Data';
        statusElement.className = 'status-indicator status-high';
        tbrElement.textContent = '--';
        break;
      default:
        statusElement.textContent = 'Error';
        statusElement.className = 'status-indicator status-high';
        tbrElement.textContent = '--';
    }
  }

  // Manejar modo simulaci√≥n
  function handleSimulatedMode(data) {
    const statusElement = document.getElementById('tbrStatus');
    statusElement.textContent = 'üîÑ Simulated';
    statusElement.className = 'status-indicator status-elevated';

    if (!document.getElementById('simulationAlert')) {
      const alert = document.createElement('div');
      alert.id = 'simulationAlert';
      alert.className = 'instructions-alert';
      alert.style.backgroundColor = 'rgba(243, 156, 18, 0.2)';
      alert.style.borderColor = '#f39c12';
      alert.innerHTML = `
      <strong>üîÑ Modo Simulaci√≥n:</strong> 
      El dispositivo EEG no est√° conectado. Se est√°n usando datos simulados para demostraci√≥n.
      <button style="float: right; background: none; border: none; color: #f39c12; font-size: 1.2rem; cursor: pointer;" onclick="this.parentElement.remove()">√ó</button>
    `;
      document
        .querySelector('.focus-container')
        .insertBefore(
          alert,
          document.querySelector('.game-header').nextSibling
        );
    }
  }

  // Actualizar estado TBR
  function updateTBRStatus(tbr, data) {
    const statusElement = document.getElementById('tbrStatus');
    const threshold = data.tbr_max || 1.5;

    if (tbr < threshold * 0.8) {
      statusElement.textContent = 'Normal';
      statusElement.className = 'status-indicator status-normal';
    } else if (tbr < threshold) {
      statusElement.textContent = 'Elevated';
      statusElement.className = 'status-indicator status-elevated';
    } else {
      statusElement.textContent = 'High';
      statusElement.className = 'status-indicator status-high';
    }
  }

  // Resultados
  function showResults() {
    const avgReactionTime =
      reactionTimes.length > 0
        ? Math.round(
            reactionTimes.reduce((a, b) => a + b, 0) / reactionTimes.length
          )
        : 0;

    const avgTBR =
      tbrValues.length > 0
        ? (tbrValues.reduce((a, b) => a + b, 0) / tbrValues.length).toFixed(2)
        : '0.00';

    const accuracy =
      totalTargets > 0 ? Math.round((hits / totalTargets) * 100) : 100;
    const score = calculateScore();

    // Actualizar modal
    document.getElementById('finalTime').textContent = formatTime(
      GAME_DURATION - timeRemaining
    );
    document.getElementById('finalHits').textContent = hits;
    document.getElementById('finalOmissions').textContent = omissions;
    document.getElementById('finalCommissions').textContent = commissions;
    document.getElementById('finalAccuracy').textContent = `${accuracy}%`;
    document.getElementById(
      'finalReactionTime'
    ).textContent = `${avgReactionTime}ms`;
    document.getElementById('finalTBR').textContent = avgTBR;
    document.getElementById('finalScore').textContent = score;

    // Mostrar modal
    document.getElementById('resultsModal').style.display = 'block';
  }

  function closeResults() {
    document.getElementById('resultsModal').style.display = 'none';
  }

  function formatTime(seconds) {
    const minutes = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${minutes}:${secs.toString().padStart(2, '0')}`;
  }

  function calculateScore() {
    if (totalTargets === 0) return 100;

    const accuracy = (hits / totalTargets) * 100;
    const avgReactionTime =
      reactionTimes.length > 0
        ? reactionTimes.reduce((a, b) => a + b, 0) / reactionTimes.length
        : 1000;

    // Puntuaci√≥n basada en precisi√≥n, velocidad y consistencia
    const accuracyScore = accuracy; // 0-100
    const speedScore = Math.max(0, 100 - (avgReactionTime - 300) / 10); // Bonus por reacciones r√°pidas
    const consistencyScore = Math.max(0, 100 - commissions * 10); // Penalizaci√≥n por comisiones

    return Math.min(
      100,
      Math.round(
        accuracyScore * 0.5 + speedScore * 0.3 + consistencyScore * 0.2
      )
    );
  }

  // Guardar resultados
  function saveGameResults() {
    const results = {
      game: 'focus_hunter',
      timestamp: new Date().toISOString(),
      duration: GAME_DURATION - timeRemaining,
      hits: hits,
      omissions: omissions,
      commissions: commissions,
      totalTargets: totalTargets,
      totalNonTargets: totalNonTargets,
      accuracy:
        totalTargets > 0 ? Math.round((hits / totalTargets) * 100) : 100,
      avgReactionTime:
        reactionTimes.length > 0
          ? Math.round(
              reactionTimes.reduce((a, b) => a + b, 0) / reactionTimes.length
            )
          : 0,
      reactionTimes: reactionTimes,
      avgTBR:
        tbrValues.length > 0
          ? (tbrValues.reduce((a, b) => a + b, 0) / tbrValues.length).toFixed(2)
          : '0.00',
      tbrValues: tbrValues,
      score: calculateScore(),
    };

    // Guardar en localStorage
    const savedResults = JSON.parse(
      localStorage.getItem('focusHunterResults') || '[]'
    );
    savedResults.push(results);
    localStorage.setItem('focusHunterResults', JSON.stringify(savedResults));

    // Enviar al servidor
    fetch('/save_game_result', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(results),
    }).catch(error => console.error('Error guardando resultados:', error));
  }

  // Verificar conexi√≥n EEG al cargar la p√°gina
  document.addEventListener('DOMContentLoaded', function () {
    fetch('/tbr_value')
      .then(response => response.json())
      .then(data => {
        if (data.error) {
          handleTBRError(data);
          if (data.error === 'not_calibrated') {
            console.log('Sistema no calibrado');
          } else if (data.error === 'eeg_disconnected') {
            console.log('EEG desconectado');
          }
        } else {
          // Verificar si es modo simulaci√≥n
          if (data.simulated) {
            handleSimulatedMode(data);
          } else {
            document.getElementById('tbrStatus').textContent = 'Connected';
            document.getElementById('tbrStatus').className =
              'status-indicator status-normal';
          }
          document.getElementById('currentTBR').textContent =
            data.tbr_value.toFixed(2);
        }
      })
      .catch(error => {
        console.error('Error al verificar conexi√≥n EEG:', error);
        document.getElementById('tbrStatus').textContent = 'Error';
        document.getElementById('tbrStatus').className =
          'status-indicator status-high';
      });
  });
</script>

{% endblock %}
